<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>致以逝去的朋友——《2023年1月表深渊闪灵同调卡组攻略文档》</title>
    <link href="/2023/04/07/ygo-note-1/"/>
    <url>/2023/04/07/ygo-note-1/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文要讲的卡组是以深渊兽、卫星闪灵以及一定数量的光暗2星调整组成，通过资源调度做出混沌魔龙积累大量墓地资源，最终目的是做出淘气精灵链接端的两只同调怪兽以及卫星闪灵系统的软阻抗。由于游戏王四月表的更新，深渊之兽的核心赫界龙和卫星闪灵的核心蓝色喷流灵都遭到了限一规制，因此本套卡组也就不复存在。这篇文章的意义也不过是纪念我的第一次参加大型比赛时所用的卡组，当然也在这套卡组上投入了不少心血。</p><h2 id="卡组构筑"><a href="#卡组构筑" class="headerlink" title="卡组构筑"></a>卡组构筑</h2><p><img src="/2023/04/07/ygo-note-1/%E4%B8%BB%E5%8D%A1%E7%BB%84.png"><br><img src="/2023/04/07/ygo-note-1/extra-side.png"></p><p>深渊兽方面：由于玛格巨龙在1月表限一，因此对能提供回合内精堆能力的萨隆魔龙下三，这也是为了保证卡组内深渊兽的浓度，以针对环境的定义者——珠泪卡组，这也是本卡组在1月表环境能够生存的一点原因。</p><p>卫星闪灵方面：采取常规闪灵小轴数量，除小蓝外其他全部只下1.</p><p>调整方面：尸忍1，百檎龙2，强袭同调士2。由于卡组内卫星龙炮的存在，能够提供精堆两星调整的能力，因此对于调整的浓度要求不高。同时调整上手大多需求通招（特招的强袭同调士有同调自肃），因此在最终卡组调整的时候减少了卡组内2星调整的浓度。</p><p>手坑：常规3灰3g3指，多携带了一张幽鬼兔用于针对环境内的超重系卡组，同时对俱舍纯爱等卡组也有一定打击，同时自身也是光属性，在墓地能够给深渊兽提供起跳的对象，也可以被混沌魔龙检索上手，实战中效果不错。由于本卡组携带了大量深渊兽，因此在后手对局中也能提供给对手大量回合外干扰。三战之才，高power卡，吃到手坑时的反制手段。</p><p>其他：电子界小工具，本卡组最强通招点，一卡卫星龙炮，详细使用方法会在下面单卡介绍中记述。混沌领域，赫界龙检索点，进墓的抽卡回收补点。乌爪鸦，小爱神可以检索的两星补点，不如连锁特招，相比缓存猫娃使用体验更好一点。</p><h2 id="单卡分析"><a href="#单卡分析" class="headerlink" title="单卡分析"></a>单卡分析</h2><p><img src="/2023/04/07/ygo-note-1/%E8%B5%AB%E7%95%8C%E9%BE%99.png"><br>深渊之兽赫界龙，深渊兽系统的调度核心，用法很多。</p><p>首先是检索，检索首先考虑手牌中深渊之兽的种类，优先检索手牌不存在的深渊兽，其次考虑墓地光暗资源，如果墓地只有赫界龙一张光暗，则可以检索萨隆魔龙，萨隆魔龙除外赫界龙起跳，当其送墓时可以再堆一张赫界龙保证墓地中有赫界龙可以起跳。当墓地有其他光暗起跳点，手牌资源一般时可检索玛格巨龙，在ep检索其他深渊兽提供下回合的干扰能力。最后如果手牌资源很充足，也可以检索萨隆堆墓绿阵，ep红阵把绿阵贴上来，提供更立体的终场，当然这种展开也丧失了当回合回一抽一的赚资源点。</p><p>赫界龙的特招一般依靠吃掉场上存在的深渊兽和混沌魔龙。2效果贴永续的选择大多数情况下选择绿阵赚资源，也可以选择红阵提供后场除去解场能力，具体使用比较灵活。（一般看哪个贴纸还没被混沌魔龙堆进墓地（x））</p><p><img src="/2023/04/07/ygo-note-1/%E9%B8%9F%E9%BE%99.png"><br>鸟龙的主要功能是被玛格巨龙检索提供下回合一次除外的能力，理想情况下是解放当回合绿阵拉出来的发过效果的玛格巨龙发动效果，也可以与德鲁伊鳞虫联动触发其送墓效果。通常不是赫界龙的优先检索卡。<br><img src="/2023/04/07/ygo-note-1/%E5%BE%B7%E9%B2%81%E4%BC%8A.png"><br>德鲁伊鳞虫的主要作用是提供一次除去的能力，回合外干扰和回合内解场的能力都很强大。其送墓解场的效果也能解决环境内的No.41等卡片。<br><img src="/2023/04/07/ygo-note-1/%E7%8E%9B%E6%A0%BC%E5%B7%A8%E9%BE%99.png"><br>玛格的作用主要是提供一次广范围的龙族检索，可以当回合发效果，下回合被绿阵拉出来再发效果，提供很强大的续航能力，其单卡power很高。但该卡的尴尬之处也在于其检索是ep处理，对于当回合的展开没有帮助，同时实战中很难遇到玛格发挥作用的拉锯战，所以是张蛮尴尬的卡，不过由于其赚卡能力，依然是赫界龙的优先检索点。<br><img src="/2023/04/07/ygo-note-1/%E8%90%A8%E9%9A%86.png"><br>萨隆，深渊兽的大腿，当回合堆墓的能力，能够堆下赫界龙以及绿阵。其作为混沌魔龙的同调素材进墓时，也能够自排连锁帮助混沌魔龙躲灰。</p><p><img src="/2023/04/07/ygo-note-1/%E5%B0%8F%E5%B7%A5%E5%85%B7.png"><br>本卡组最强通招点，一卡卫星龙炮。具体使用方式是：通招电子界工具，如果先手的话墓地一般没有两星可以拉，后手可以拉先手丢出的增殖的G（如果有的话），当然也可以模仿废二玩家在自己回合丢G，然后用电子界工具拉起来，通常没有必要，因为大多数情况并不缺这一个两星补点。电子界工具链接召唤link1连环栗子球，进墓发动效果生一个两星token。这一步有两个关键，一个是连环栗子球能够提供自己回合的一次陷阱康，帮助混沌魔龙躲避无限泡影或者后手应对对手红坑的对策；另一个是token的存在能够提供给百檎龙1效果场上存在效果怪兽以外的怪兽可以特招的能力，场上的2星token加上百檎龙即可达成同调召唤混沌魔龙的目的（出小爱神加百檎龙墓地效果）。如果上一步还没有获得能够召唤混沌魔龙的场面，那么下一步可以链接召唤link2卫星龙炮堆墓尸忍，手牌的深渊兽除外尸忍起跳，即可同调召唤混沌魔龙。</p><p>另一个本人在实战中经常使用的技巧是后手，如果场上有上回合特招过的深渊兽，通招电子界工具可以同调召唤混沌之双翼，给自己的同调怪兽提供伪全抗的抗性加上一次取对象的除外能力，这也依赖于对方觉得你场上没有两星没有调整而不交阻抗的大意，但一旦完成power还是很高的。</p><p>其实电子界工具的厉害之处在于它表面上与本卡组的“格格不入”的特征，当对手看到你通招电子界工具时，通常会因为不知道你下一步会怎么做陷入犹豫，而下一步的动作则往往会逼出对手不可承受的资源。其送墓生token的能力也不怕常规意义上的除去手段，本质上是一种信息差战略。</p><p><img src="/2023/04/07/ygo-note-1/%E4%B9%8C%E7%88%AA%E9%B8%A6.png"></p><p>小爱神检索点，基本起手稳定有（❌）。不如连锁的2星特招点，特招条件也比较简单，可以作为补点较为轻松地过渡到卫星龙炮&#x2F;巨大喷流等。</p><p><img src="/2023/04/07/ygo-note-1/%E5%B0%B8%E5%BF%8D.png"></p><p>在墓地为了效果发动而被除外时可以从特招，一般作为卫星龙炮的首选堆墓点，通常使用深渊兽或者混沌魔龙除外来触发其特招效果</p><p><img src="/2023/04/07/ygo-note-1/%E5%BC%BA%E8%A2%AD%E5%90%8C%E8%B0%83%E5%A3%AB.png"><br>不占通招的2星调整出场，在墓地时可以除外自身来特招被解放或者除外的深渊之神兽&#x2F;混沌魔龙。在展开中通常用于回收墓地特招离场除外的混沌魔龙（一般赫界龙解放混沌魔龙时不发效果，第二次离场除外时发效果，这样能保证最终混沌魔龙是在墓地，下回合有机会继续起跳）。深渊之神兽登场后也可以优先特招除外区的强袭同调士，可以在墓地作为对部分解场手段的保护措施。</p><p><img src="/2023/04/07/ygo-note-1/%E8%8B%B9%E6%9E%9C.png"><br>可以在一回合内提供两个两星调整点，作为通招点配合闪灵系统是完全不亏的，也能配合小工具的token特招。被混沌魔龙&#x2F;卫星龙炮也可以在同调召唤成功的回合提供2星补点。另外可以被玛格巨龙检索上手。</p><p><img src="/2023/04/07/ygo-note-1/%E6%B7%B7%E6%B2%8C%E9%A2%86%E5%9F%9F.png"><br>上手可以用来检索赫界龙，但是2换1找赫界龙并不能说是很赚，多数情况下期望被混沌魔龙堆进墓地回一抽一，故只下1，作为上限卡。</p><p>闪灵系统的卡不在详细介绍，单独上手时可以按闪灵系统一套打完，和2星调整的配合将在combo部分详细讲述。</p><p><img src="/2023/04/07/ygo-note-1/%E5%8F%8C%E7%BF%BC.png"><br>单卡power很强的一张卡，后手能够前置做出伪全抗双翼能为后续展开提供护航和一次取对象的除外。环境内强势的珠泪卡组很难解掉光暗属性出的双翼（由于卡组内暗属性怪兽较多，通常有光就有暗，难的是找到光属性素材）</p><p>比较常见的出场方式：深渊兽+小工具；混沌魔龙+百檎龙token；赫界龙+2星暗属性；混沌魔龙+2星暗属性（只有一次除外和不被战破，没有伪全抗效果）</p><p><img src="/2023/04/07/ygo-note-1/%E7%A5%9E%E5%85%BD.png"><br>提供了一次怪效康&#x2F;破坏，并提供了除外区资源调度能力，能够回收除外区的2星调整帮助在调整资源不足的情况下继续做出同调终端。通常在混沌魔龙堆墓质量没有达到预期时，先做神兽，提供一次额外的调整补点能够后续补出鲜花。</p><p>note：神兽可以被绿阵复苏，必要的时候可以将神兽送墓以达到其他目的，再在对手回合苏生。</p><p><img src="/2023/04/07/ygo-note-1/%E6%89%BF%E5%BD%B1.png"><br>泛用10星同调终端，常用作斩杀，本家和环境内的俱舍卡组都能提供大量的除外资源。</p><p><img src="/2023/04/07/ygo-note-1/%E9%B2%9C%E8%8A%B1.png"><br>能出十星白的卡组没有不带这张卡的，略。</p><p><img src="/2023/04/07/ygo-note-1/%E9%AD%94%E9%BE%99.png"><br>卡组资源运转核心，展开前期所有的努力都在为了出混沌魔龙和尽量让混沌魔龙不吃灰。只要成功出场，通常能收获不错的资源积累。塔玛希卡片。</p><p><img src="/2023/04/07/ygo-note-1/%E9%AA%A8%E6%9E%B6%E7%8E%8B.png"><br>正常做场时通常不使用，在资源比较充足的局势时，可以出骨架王削1加神兽苏生再削1，先手削2配合1神兽+闪灵系的干扰，通常可以较轻松地拿下比赛。（更极端的情况是混沌领域可以回收一次骨架王再出一次削1，但这种情况对手牌和墓地资源质量要求过高）</p><p><img src="/2023/04/07/ygo-note-1/%E7%91%9A%E4%B9%8B%E9%BE%99.png"><br>提供一个小爱神已经用过的六星调整选项，同时拥有单卡去除能力以及入墓抽一的效果能够保证一定程度上的不亏资源。</p><p><img src="/2023/04/07/ygo-note-1/%E5%B0%8F%E7%88%B1%E7%A5%9E.png"><br>卡组核心中转站，其星级改变效果进可变6星出混沌魔龙，退可变两星与闪灵系统联动或更多星级选择。作为同调素材入墓后的检索也能提供续航。</p><p><img src="/2023/04/07/ygo-note-1/%E9%AB%98%E8%BE%BE.png"><br>可以不用，但不能没有的一张卡。实战中很难用出来，但多数情况下会被俱舍的电脑兽和独角兽作为除外的优先目标：）。</p><p><img src="/2023/04/07/ygo-note-1/%E8%9A%8A%E5%AD%A6.png"><br>闪灵系统的斩杀卡，也可以作为高达的驾驶员。一定程度上可以在出乎意料的情况下完成斩杀。</p><p><img src="/2023/04/07/ygo-note-1/%E5%B7%A8%E5%A4%A7%E5%96%B7%E6%B5%81.png"><br><img src="/2023/04/07/ygo-note-1/%E6%B7%98%E6%B0%94.png"><br>巨大喷流的2自肃与卡组核心系统并不兼容，因此不能像雷铁那样的闪灵系卡组一样作为卡组的启动点。主要作用是在调整资源用完后，用卫星龙炮+2星怪兽出巨大喷流调度闪灵系统的干扰，最后做出淘气精灵来提供链接端的抗性和胡萝卜&#x2F;小红的干扰。</p><p><img src="/2023/04/07/ygo-note-1/%E5%A4%A9%E7%90%83.png"><br>场上只存在深渊兽系统的吃坑后妥协手段，其解放自己特招玛格巨龙可以检索百檎龙保证下回合的展开。（通常出天球的情况意味着局势已经比较劣势了）</p><p><img src="/2023/04/07/ygo-note-1/%E8%BF%9E%E7%8E%AF.png"><br>电子界小工具可以单卡出，提供电子界小工具送墓手段和一次陷阱康能力，出场率很高。</p><h2 id="常用Combo"><a href="#常用Combo" class="headerlink" title="常用Combo"></a>常用Combo</h2><h3 id="2星调整-小蓝"><a href="#2星调整-小蓝" class="headerlink" title="2星调整 + 小蓝"></a>2星调整 + 小蓝</h3><p>通招两星调整（强袭同调士可以用自己效果特招），特招小蓝检索喷流灵，喷流灵检索一张闪灵魔法（通常我喜欢，主卡局检索粉碎者集群来提供更多阻抗，side局检索启辉器保证吃坑后的下限）。同调召唤小爱神效果变6星，和剩下的另一个闪灵同调召唤混沌魔龙：C1小爱神（效果必发）C2混沌魔龙堆五后根据墓地资源正常展开。</p><h3 id="电子界工具-百檎龙"><a href="#电子界工具-百檎龙" class="headerlink" title="电子界工具 + 百檎龙"></a>电子界工具 + 百檎龙</h3><p>通招工具，链接召唤连环库里波，工具送墓效果生token，百檎龙效果特招，出小爱神效果变6星，百檎龙墓地除外生2星token，出混沌魔龙。</p><h3 id="电子界工具-深渊兽"><a href="#电子界工具-深渊兽" class="headerlink" title="电子界工具 + 深渊兽"></a>电子界工具 + 深渊兽</h3><p>通招工具，链接召唤连环库里波，工具送墓效果生token，链接召唤卫星龙炮效果堆墓尸忍，深渊兽除外尸忍起跳，尸忍效果特招出混沌魔龙。（同样适用于深渊兽与其他能出卫星龙炮的手牌情况）</p><h3 id="混沌魔龙之后的动作"><a href="#混沌魔龙之后的动作" class="headerlink" title="混沌魔龙之后的动作"></a>混沌魔龙之后的动作</h3><p>根据情况，可以先出鲜花女男爵&#x2F;深渊之神兽+卫星龙炮，卫星龙炮堆墓的对象选择墓地不存在的2星调整来补足资源种类（三个调整均有墓地效果），混沌魔龙墓地起跳之后再做第二个同调终端，之后保证场上能够留下两星补点以供后续出巨大喷流。</p><h3 id="闪灵系的动作"><a href="#闪灵系的动作" class="headerlink" title="闪灵系的动作"></a>闪灵系的动作</h3><p>通常根据墓地资源做出鲜花女男爵+深渊之神兽+卫星龙炮+2星补点的场，出巨大喷流发效果调度其余闪灵，出淘气精灵，链接端指向两只同调怪兽，拉一只小红&#x2F;胡萝卜上来，在对面回合可以再拉另一只或者拉小蓝提供续航。</p><h2 id="北京站记录"><a href="#北京站记录" class="headerlink" title="北京站记录"></a>北京站记录</h2><p>笔者使用这套卡组参加了中国游戏王OCG巡回赛北京站，4-3出局，下面留下当时参加时的笔记以作参考。</p><h3 id="round-1-vs魔术师-输骰-⭕⭕"><a href="#round-1-vs魔术师-输骰-⭕⭕" class="headerlink" title="round 1 vs魔术师 输骰 ⭕⭕"></a>round 1 vs魔术师 输骰 ⭕⭕</h3><p>g1对面通招天空开 我丢g 对面特招两次做41摆烂过 结束阶段忘记处理天空效果 t2我过不了41 t3对面41转攻 战阶跳融解者 主2融解者效果吃幽鬼兔 t4我展开成功斩杀<br>g2 对面星刻检索吃锁鸟 做风雷龙过 t2我手牌质量可以 过康斩杀</p><h3 id="round2-vs泪冠哀歌-输骰-⭕❌⭕"><a href="#round2-vs泪冠哀歌-输骰-⭕❌⭕" class="headerlink" title="round2 vs泪冠哀歌 输骰 ⭕❌⭕"></a>round2 vs泪冠哀歌 输骰 ⭕❌⭕</h3><p>g1对面先攻卡手 我后攻成功展开赢<br>g2堆墓不停 全部堆进墓地 到我t2吃到g 一轮资源交换对面卡组剩余14张手里雷精一套没打，但是渣操小爱神叫效果变了6星 墓地混沌魔龙起跳没法继续做 投降<br>g3先攻成功展开拿下</p><h3 id="round3-vs俱舍怒威族-赢骰-❌⭕⭕"><a href="#round3-vs俱舍怒威族-赢骰-❌⭕⭕" class="headerlink" title="round3 vs俱舍怒威族 赢骰 ❌⭕⭕"></a>round3 vs俱舍怒威族 赢骰 ❌⭕⭕</h3><p>g1 先攻吃到大宇宙人停牌 被对面t2斩杀<br>g2 先攻不能展开 对面后攻我丢g被灰但手里有陨石 双7开做银河战斧鹰吃到陨石 t3我斩杀<br>g3 对面先攻准阶丢大宇宙人 我连锁丢g 对面金谦壶翻六吃到灰流丽到我 t2大宇宙人生效中我通招电子界小工具打一刀过 t3对面盖下剑指到我 t4吃到g 我除外大宇宙人跳深渊兽 和小工具做混沌双翼护航 手里补点够多成功斩杀</p><h3 id="round4-vs雷铁-赢骰-⭕❌❌"><a href="#round4-vs雷铁-赢骰-⭕❌❌" class="headerlink" title="round4 vs雷铁 赢骰 ⭕❌❌"></a>round4 vs雷铁 赢骰 ⭕❌❌</h3><p>g1 先攻展开成功 对面直接投降（未知卡组信息）<br>g2 对面通招河狸开 由于卡组未知 side不够针对 打不过投了<br>g3 混沌魔龙吃灰 终场淘气深渊神兽胡萝卜后场粉碎者过 对面准阶一滴丢鮟鱇加纳贝尔无效神兽淘气拿下（中间吃了不了解猫娘效果的亏，被取我的小蓝为对象启动了他的雷精轴）</p><h3 id="round5-vs泪冠哀歌-赢骰-❌❌"><a href="#round5-vs泪冠哀歌-赢骰-❌❌" class="headerlink" title="round5 vs泪冠哀歌 赢骰 ❌❌"></a>round5 vs泪冠哀歌 赢骰 ❌❌</h3><p>g1 先攻吃g 大喷妥协被灰 t2被斩杀<br>g2 先攻吃g停牌 t2被斩杀</p><h3 id="round6-vs神碑星因士-输骰-❌⭕⭕"><a href="#round6-vs神碑星因士-输骰-❌⭕⭕" class="headerlink" title="round6 vs神碑星因士 输骰 ❌⭕⭕"></a>round6 vs神碑星因士 输骰 ❌⭕⭕</h3><p>g1 对面先攻做出冬钻龙加托勒密 手牌过不了投降<br>g2 我先攻最大场 对面投降<br>g3 对面先攻终场狮鹫加托勒密 后场神碑一炸 t1结束阶段正好我在处理玛格巨龙效果时进入死三 到我海龟吃掉狮鹫 和对面资源交换后手牌剩余一张深渊兽 特招进战阶打掉对面几百lp 到他由于神碑魔法跳过了战阶 死三获胜无望投降</p><h3 id="round7-vs泪冠哀歌-赢骰-❌❌"><a href="#round7-vs泪冠哀歌-赢骰-❌❌" class="headerlink" title="round7 vs泪冠哀歌 赢骰 ❌❌"></a>round7 vs泪冠哀歌 赢骰 ❌❌</h3><p>g1 先攻吃g 龙炮被古尖兵弹掉停牌 t2被斩杀<br>g2 先攻吃g 手牌质量太差 t2被斩杀</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>这套卡组随着游戏王2023年4月表的更新已经不复其存在意义，其在1月表期间对卫星闪灵系统和2星调整的联动出混沌魔龙赚取资源的方式是比较吸引我的地方。卡组中高浓度的深渊兽也让其在面对环境霸主珠泪时能够有一战之力。但其也有一定的固有劣势，比如很难妥协中g死，被次元系和下水道误伤等等。希望这篇文章能够记录这套卡组存在的这段时间，以作纪念。</p>]]></content>
    
    
    
    <tags>
      
      <tag>游戏王ocg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>分布式训练学习笔记</title>
    <link href="/2023/04/02/parrel-training/"/>
    <url>/2023/04/02/parrel-training/</url>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#%E5%B9%B6%E8%A1%8C%E8%AE%AD%E7%BB%83%E6%A6%82%E8%A6%81">并行训练概要</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A1%8C">数据并行</a></li><li><a href="#%E6%A8%A1%E5%9E%8B%E5%B9%B6%E8%A1%8C">模型并行</a></li></ul><!-- tocstop --><p>这篇博客记录了我在学习分布式训练的过程中的相关知识与实践经验。</p><h3 id="并行训练概要"><a href="#并行训练概要" class="headerlink" title="并行训练概要"></a>并行训练概要</h3><p>并行训练主要需要解决的痛点是两个：</p><ol><li>大模型训练时间过长</li><li>单个GPU显存有限，可能无法完整的容纳一个模型</li></ol><p>分布式训练技术可以通过将模型部署到多个GPU上来解决上述两个问题。可以分为数据并行、张量并行以及流水线并行</p><h3 id="数据并行"><a href="#数据并行" class="headerlink" title="数据并行"></a>数据并行</h3><h3 id="模型并行"><a href="#模型并行" class="headerlink" title="模型并行"></a>模型并行</h3>]]></content>
    
    
    
    <tags>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>论文阅读笔记《BaGuaLu:Targeting Brain Scale Pretrained Models with over 37 Million Cores》</title>
    <link href="/2023/04/02/paper-bagualu-1/"/>
    <url>/2023/04/02/paper-bagualu-1/</url>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#%E8%83%8C%E6%99%AF">背景</a></li><li><a href="#methods">Methods</a><ul><li><a href="#%E8%8A%82%E7%82%B9%E5%86%85%E4%BC%98%E5%8C%96">节点内优化</a></li><li><a href="#%E6%B7%B7%E5%90%88%E5%B9%B6%E8%A1%8C%E7%AD%96%E7%95%A5">混合并行策略</a></li><li><a href="#%E6%B7%B7%E5%90%88%E7%B2%BE%E5%BA%A6%E8%AE%AD%E7%BB%83">混合精度训练</a></li></ul></li><li><a href="#%E6%80%A7%E8%83%BD%E8%AF%84%E4%BC%B0">性能评估</a></li><li><a href="#%E7%9B%B8%E5%85%B3%E9%98%85%E8%AF%BB%E9%93%BE%E6%8E%A5">相关阅读链接</a></li></ul><!-- tocstop --><p>这篇论文来自PPoPP‘22：<a href="https://pacman.cs.tsinghua.edu.cn/~zjd/publication/ppopp22-bagualu/ppopp22-bagualu.pdf">https://pacman.cs.tsinghua.edu.cn/~zjd/publication/ppopp22-bagualu/ppopp22-bagualu.pdf</a></p><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>目前大模型因为使用了大量的参数使其精确度达到了领域前沿，比如CV、NLP等领域都有比较典型的大模型运用实例。这里作者举了MoE（Mixture of Experts）的例子，这是一种通过多种子专家网络和一个门控开关控制哪些子网络被选取的网络结构，这种网络设计已经在机器翻译等领域取得了成功。</p><p>但是目前大规模预训练模型仍然面临着一些问题，受到计算、存储、网络性能等多种因素的影响，因此目前的大模型是有潜力被继续拓展到更大规模的集群&#x2F;更多参数。</p><p>本文要部署大模型的平台是新一代神威超级计算机（New Generation Sunway Supercomputer，1 EFLOPS peek performance）,基于这个背景，作者提出了这项工作所面临的挑战，个人认为也是这篇文章的核心问题。</p><ol><li>硬件架构：超级计算机的架构大多是专门设计的，需要精心设计以使得软件应用于硬件架构有效结合 以充分发挥硬件的优势</li><li>存储容量：大模型和参数和中间结果需要占据大量的存储空间，为了放下这些内容我们需要对其进行划分，而不同的划分也会导致不同的通信策略</li><li>并行策略：要在超大规模的超算上部署就需要重新设计并行策略，比如上文的MoE在只使用数据并行时会带来大量的AllReduce开销</li><li>混合精度：传统科学计算问题多使用双精度，但是AI应用一般会使用单精度或者混合精度来最大化吞吐量。Sunway提供了多种精度，因为需要考虑混合精度如何充分利用的问题</li></ol><p>BaGuaLu 可以训练达到 14.5-trillion个参数使用1.002 EFLOPS的算力。BaGuaLu有能力拓展到174trillion个参数，这将和人脑中突触的数目相当。</p><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><h4 id="节点内优化"><a href="#节点内优化" class="headerlink" title="节点内优化"></a>节点内优化</h4><ol><li>核组调度：一个MPE负责计算，其他5个MPE负责处理通信相关以最大限度降低通信开销，减少进程数<br><img src="/2023/04/02/paper-bagualu-1/1.png" alt="1"></li><li>内存划分：每一行都由位于对角线上的CPE接受DMA请求，之后再通过RMA传输<br><img src="/2023/04/02/paper-bagualu-1/2.png" alt="2"></li></ol><h4 id="混合并行策略"><a href="#混合并行策略" class="headerlink" title="混合并行策略"></a>混合并行策略</h4><ol><li><p>Hybrid MoE parallelism and data parallelism strategy(MoDa)：模型并行与数据并行混合策略。也是并行训练中经常用到的优化方法。具体到本文中主要指针对神威的节点互联架构。如下图所示，对于右边这种胖树结构的节点布置，supernode间的通讯带宽是supernode内的通信带宽3&#x2F;16，因此需要考虑如何安排AlltoAll和AllReduce。文章中提到，经过测试发现AllReduce的次数是AlltoAll的16-24倍，因此将AllReduce安排在supernode内做，以减少通讯时间。<br><img src="/2023/04/02/paper-bagualu-1/Sunway.png" alt="3"></p></li><li><p>Parallel partition-based optimizer (ParO)：分割存储优化器等策略。这种优化策略在DeepSpeed提出的ZeRO中已经有过实现，主要是将梯度、参数、优化器等信息分别存储在不同的进程中以压缩存储空间。由于模型的规模较大，因此在本文中optimizer占据的空间可能只到其他数据的5%左右（参数、梯度、中间结果等）。因此，ParO只将十分之一到七分之一的参数进行全局共享。模型中的worker按照2D-grid存储，梯度首先在supernode内进行Reduce-Scatter（一个维度）之后在supernode间进行All-Reduce（另一个维度），更新之后，参数再在supernode内进行All-Gather。这种分割存储optimizer的方式有另一个好处，就是可以很方便的存储模型的checkpoint。</p></li><li><p>SunWay Imbalance Proficiently Eliminated (SWIPE)：这是一种实现负载均衡的策略。因为MoE存在的固有问题就是每次迭代都会有一部分的Expert处理很多的输入，而有一些Expert又很空闲。因此本文设计了一种算法：每个worker持有一个expert，接受一份输入，每个expert最后得到的样本数要求是相同的。首先获得每个输入样本对各个expert的打分，让每个样本去打分最高的expert那里，经过这一步之后，就会有一些样本溢出的和部分空闲的expert，之后每个worker根据对这个溢出数量和空闲容量表的查询进行分发，以达到负载均衡的目的。这样的算法只需要常数次通讯次数。一个更近一步的优化在与本文相关的另一篇PPoPP’22的文章中阐述（<a href="https://dl.acm.org/doi/10.1145/3503221.3508418%EF%BC%89%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E4%B8%80%E7%A7%8D%E8%80%83%E8%99%91%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E7%9A%84%E9%97%A8%E7%BD%91%E7%BB%9C%EF%BC%88Topology-aware">https://dl.acm.org/doi/10.1145/3503221.3508418），可以实现一种考虑网络拓扑的门网络（Topology-aware</a> Gate），考虑硬件连接的拓扑关系. 限制跨机器选择专家的输入数量.让多余的输入按照分数重新在本节点内选择一个喜欢的专家来进行处理，即考虑了节点间通讯延迟的gate。<br><img src="/2023/04/02/paper-bagualu-1/3.png" alt="4"></p></li></ol><h4 id="混合精度训练"><a href="#混合精度训练" class="headerlink" title="混合精度训练"></a>混合精度训练</h4><p>这里首先提出了常规大模型训练使用的一些混合精度策略，如NVIDIA的APEX：</p><ul><li>O0: FP32 training.</li><li>O1: Use FP16 in certain operators, such as GEMM or convolution. The inputs will be cast before and after the mixedprecision operation.</li><li>O2: Cast weights and input data to FP16 and maintain an FP32 master weight for optimization.</li><li>O3: FP16 training.</li></ul><p>在NVIDIA GPU上一般O1、O2的策略都能取得与O0相同的效果，但是在神威上这个结论却不生效。O1策略由于存在大量的数据类型转换，而神威的内存带宽较低，从而严重影响性能。而O2是因为FP16的数据过多造成了大量的overflow出现使得模型难以收敛。</p><p>因此本文工作就对模型的每一层都进行不同策略实验，得到了最优配置如下。<br><img src="/2023/04/02/paper-bagualu-1/4.png" alt="5"></p><h3 id="性能评估"><a href="#性能评估" class="headerlink" title="性能评估"></a>性能评估</h3><p>略</p><h3 id="相关阅读链接"><a href="#相关阅读链接" class="headerlink" title="相关阅读链接"></a>相关阅读链接</h3><ol><li><a href="https://laekov.com.cn/view/181401#howto">https://laekov.com.cn/view/181401#howto</a></li><li><a href="https://github.com/laekov/fastmoe">https://github.com/laekov/fastmoe</a></li><li><a href="https://youtu.be/T3-6WH1GyRw">https://youtu.be/T3-6WH1GyRw</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>论文阅读</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
